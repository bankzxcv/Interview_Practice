name: Secrets Demo

on:
  workflow_dispatch:

jobs:
  use-secrets:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Use secret in environment variable
      env:
        API_KEY: ${{ secrets.API_KEY }}
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
      run: |
        echo "API key is set: ${API_KEY:+yes}"
        echo "Database URL is set: ${DATABASE_URL:+yes}"
        # Never echo the actual secret values!

    - name: Use secret in command
      run: |
        # Example: authenticate to a service
        echo "Authenticating..."
        # curl -H "Authorization: Bearer ${{ secrets.API_TOKEN }}" api.example.com

    - name: Conditional secret usage
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      env:
        PROD_SECRET: ${{ secrets.PRODUCTION_API_KEY }}
      run: |
        echo "Using production secrets"

    - name: Mask dynamic secrets
      run: |
        # Generate a dynamic secret
        DYNAMIC_SECRET="generated-$(date +%s)"
        # Mask it in logs
        echo "::add-mask::$DYNAMIC_SECRET"
        echo "Secret value: $DYNAMIC_SECRET"  # Will be masked
